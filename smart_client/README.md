# Kolibri Smart Client

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —É–º–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è —è–¥—Ä–∞ Kolibri (FA-10 + KPRL). –ü—Ä–æ–µ–∫—Ç –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ FastAPI –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π SPA/PWA-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –≥–æ–ª–æ—Å–æ–º, –ø–∞–º—è—Ç—å—é –∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–µ–π –æ—Ç–≤–µ—Ç–æ–≤.

## –°–æ—Å—Ç–∞–≤ —Ä–µ—à–µ–Ω–∏—è

- **Backend (FastAPI)** ‚Äî —Å–µ—Ä–≤–∏—Å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (`smart_client/backend`). –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST –∏ SSE API, —É–ø—Ä–∞–≤–ª—è–µ—Ç TOOLS_SCHEMA, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å KPRL –∏ –≤–µ–¥—ë—Ç –∞—É–¥–∏—Ç.
- **Frontend (React + Vite + Tailwind + Zustand)** ‚Äî –æ–¥–Ω–æ—Ç—Ä–∞–Ω–∏—á–Ω–æ–µ PWA-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (`smart_client/frontend`) —Å —á–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, Ledger –∏ —ç–∫—Ä–∞–Ω–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫.
- **Prompts** ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–µ—Å–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–µ –≤ `smart_client/prompts`.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- Node.js 18+
- pnpm, npm –∏–ª–∏ yarn –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ backend

```bash
cd smart_client/backend
python3 -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -e ".[dev]"
uvicorn app.main:app --reload --port 8000

# 0) –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –≤—ã–π—Ç–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
deactivate 2>/dev/null || true

# 1) –°–æ–∑–¥–∞—ë–º venv –Ω–∞ Python 3.12 –æ—Ç Homebrew (–≤–∞–∂–Ω–æ!)
/opt/homebrew/bin/python3.12 -m venv .venv
source .venv/bin/activate

# 2) –û–±–Ω–æ–≤–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏
python -m pip install -U pip setuptools wheel

# 3) –°—Ç–∞–≤–∏–º –±—ç–∫–µ–Ω–¥ –≤ editable-—Ä–µ–∂–∏–º–µ —Å –¥–µ–≤-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (—Ç–∞–º –µ—Å—Ç—å uvicorn)
python -m pip install -e '.[dev]' || true

# –ï—Å–ª–∏ —à–∞–≥ –≤—ã—à–µ –≤–¥—Ä—É–≥ –Ω–µ –ø–æ–¥—Ç—è–Ω—É–ª uvicorn/fastapi ‚Äî –ø–æ—Å—Ç–∞–≤–∏–º —è–≤–Ω–æ (–±–µ–∑ –≤—Ä–µ–¥–∞)
python -m pip install uvicorn fastapi sse-starlette httpx aiofiles pytest

python -m uvicorn app.main:app --reload --port 8000
```


> üí° **–ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è macOS/zsh:** –∫–∞–≤—ã—á–∫–∏ –≤–æ–∫—Ä—É–≥ `.[dev]` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã. –ë–µ–∑ –Ω–∏—Ö –æ–±–æ–ª–æ—á–∫–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è
> —Ä–∞—Å–∫—Ä—ã—Ç—å —à–∞–±–ª–æ–Ω –∏ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –æ—à–∏–±–∫–æ–π `no matches found`.

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ API –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8000`. –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ API –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8000`. –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:


- `POST /api/v1/chat` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É.
- `GET /api/v1/chat/stream?session_id=...` ‚Äî –ø–æ—Ç–æ–∫ SSE —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ —Å–æ–±—ã—Ç–∏—è–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
- `GET /api/v1/history?session_id=...` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞.
- `POST /api/v1/tools/<name>` ‚Äî —Ä—É—á–Ω–æ–π –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`kg_search`, `kolibri_run`, `kolibri_verify`, `mission_plan`, `iot_safe_action`).
- `GET /api/v1/chain`, `GET /api/v1/chain/stream`, `POST /api/v1/chain/verify` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –∂—É—Ä–Ω–∞–ª–æ–º KPRL.

### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ frontend

```bash
cd smart_client/frontend
npm install
npm run dev        # —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
# –∏–ª–∏ npm run build && npm run preview –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω-—Å–±–æ—Ä–∫–∏
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–ª–∏–µ–Ω—Ç –æ–∂–∏–¥–∞–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞ `http://localhost:8000`. –í –¥–µ–≤-—Ä–µ–∂–∏–º–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ `http://localhost:5173`.

#### PWA-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- –ú–∞–Ω–∏—Ñ–µ—Å—Ç: `public/manifest.webmanifest`.
- –°–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä: `public/sw.js` (cache-first –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏ –∏ offline fallback).
- –û—Ñ–ª–∞–π–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü–∞: `public/offline.html`.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞ (¬´–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —ç–∫—Ä–∞–Ω¬ª). –í –æ—Ñ–ª–∞–π–Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∏; –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –°—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã (SSE) —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –º–µ–Ω–µ–µ 150 –º—Å –º–µ–∂–¥—É —Ç–æ–∫–µ–Ω–∞–º–∏.
- –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ (Web Speech API) –∏ –æ–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ (SpeechSynthesis) —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é.
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ RAG –∏ —Å–µ–∫—Ü–∏—è ¬´–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏¬ª –≤ –∫–∞–∂–¥–æ–º –æ—Ç–≤–µ—Ç–µ.
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏—Å—Å–∏—è–º–∏, –∑–∞–ø—É—Å–∫ `kolibri_run`/`kolibri_verify`, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ IoT-–∫–æ–º–∞–Ω–¥—ã.
- –ñ—É—Ä–Ω–∞–ª KPRL —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π FA/FA_stab/FA_map (FractalBar) –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ü–µ–ø–æ—á–µ–∫.
- –ü–∞–º—è—Ç—å —á–∞—Ç–∞ –≤ `localStorage` –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º.
- –ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π –≤ `logs/audit.log`, —Ü–µ–ø–æ—á–∫–∞ KPRL –≤ `logs/chain.jsonl`.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
cd smart_client/backend
pytest
```

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç `tests/test_smart_client_e2e.py` –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí —Å—Ç—Ä–∏–º ‚Üí –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ‚Üí –∑–∞–ø–∏—Å—å –≤ KPRL ‚Üí verify.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `KOLIBRI_LOG_DIR` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ª–æ–≥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `logs`).
- `KOLIBRI_CHAIN_PATH` ‚Äî –ø—É—Ç—å –∫ –∂—É—Ä–Ω–∞–ª—É KPRL (`logs/chain.jsonl`).
- `KOLIBRI_AUDIT_LOG` ‚Äî —Ñ–∞–π–ª –∞—É–¥–∏—Ç–∞ (`logs/audit.log`).

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- –û–ø–∞—Å–Ω—ã–µ IoT-–∫–æ–º–∞–Ω–¥—ã —Ç—Ä–µ–±—É—é—Ç —è–≤–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º.
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∫–ª—é—á–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã; –¥–æ—Å—Ç—É–ø –∫ –≤–Ω–µ—à–Ω–∏–º —Ä–µ—Å—É—Ä—Å–∞–º –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.
