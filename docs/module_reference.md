# Справочник модулей

> Актуализирует Кочуров Владислав Евгеньевич. Добавляя или изменяя файлы,
> обновляйте соответствующие записи.

## Корень репозитория

| Путь | Содержание |
| --- | --- |
| `backend/` | C-бэкенд журнала: DSL формул, генерация кандидатов, агрегация голосов, CLI. |
| `bin/` | Скомпилированные бинарники и тесты (`make` создаёт каталоги автоматически). |
| `configs/` | JSON-конфиги для запуска (`kolibri.json`). |
| `docs/` | Документация (этот файл, архитектура, roadmap, handbook и т.п.). |
| `kolibri_x/` | Python-пакет Kolibri-x. |
| `tests/` | Python- и C-тесты, покрывающие DSL, агрегацию и сценарии рантайма. |
| `logs/` | Журналы выполнения (`chain.jsonl` и вспомогательные JSON). |

## Backend (C)

| Файл | Описание |
| --- | --- |
| `backend/include/` | Заголовки для DSL, ввода/вывода и планировщика. |
| `backend/src/core.c` | Основной цикл оценки формул, генерация параметров, MSE/градиенты. |
| `backend/src/dsl.c` | DSL выражений: сериализация, вычисление, градиенты. |
| `backend/src/chainio.c` | Каноническая сериализация JSON, запись и чтение журналов. |
| `backend/src/main_run.c` | Точка входа `kolibri_run`, чтение конфигурации и запуск цикла. |
| `backend/src/main_verify.c` | CLI `kolibri_verify` для проверки журналов. |
| `backend/src/main_replay.c` | CLI `kolibri_replay` для воспроизведения сессий. |
| `backend/src/reason.c` | Логика причинности и построения цепочек рассуждений. |
| `backend/src/digit_agents.c` | Набор агентов для оценки формул. |
| `backend/src/vote_aggregate.c` | Механизм голосования и quorum. |

## Kolibri-x (Python)

### `kolibri_x/core`
- `encoders.py` — базовые и адаптивные энкодеры текста, аудио, изображений,
  сенсоров; контроллер разрешения и временной выравниватель. Расширяется
  `NoiseProfiler`, `SpeakerAdaptor`, `SensorNormalizer` согласно
  [multimodal_core](multimodal_core.md).
- `transformer.py` — FusionTransformer с `DynamicDepthController`,
  перекрёстным вниманием и `LatencyMonitor`.
- `vision.py` — диффузионный визуальный энкодер и `OnlineTokenizer` для
  компрессии видеопотоков.
- `planner.py` — нейро-семантический планировщик, структуры Plan/PlanStep.

### `kolibri_x/kg`
- `graph.py` — property-граф, CRUD API, дедупликация фактов и связи
  поддержка/противоречие.
- `rag.py` — Retrieval-Augmented Generation слой, ранжирование результатов и
  проверка достоверности.
- `ingest.py` — загрузка документов, нормализация фактов, генерация отчётов.

### `kolibri_x/runtime`
- `orchestrator.py` — `KolibriRuntime`, `SkillSandbox` и модели запросов.
- `workflow.py` — управление долгосрочными задачами и напоминаниями.
- `cache.py` — офлайн-кэш с политиками вытеснения.
- `journal.py` — совместимая с C-бэкендом запись шагов в цепочку.
- `iot.py` — мост к IoT-устройствам, проверка прав и журналирование команд.

### `kolibri_x/skills`
- `store.py` — реестр навыков, проверки политик, моки песочниц.
- `manifests/` (при появлении) — описания навыков в JSON.

### `kolibri_x/privacy`
- `consent.py` — оператор приватности, согласия, аттестация клиентов.
- `filters.py` — контент-фильтры и политики безопасности.

### `kolibri_x/personalization`
- `__init__.py` — профайлер на устройстве, эмпатический модуль, сигналы
  взаимодействий.

### `kolibri_x/xai`
- `reasoning.py` — ReasoningLog, формат объяснений и трассировка планов.
- `guards.py` — защитные механизмы и этические политики.

### `kolibri_x/eval`
- Миссии, метрики mKSI, генераторы отчётов.

## Тесты

| Файл | Назначение |
| --- | --- |
| `tests/test_reason_payload.py` | Проверка структуры причинно-следственных записей. |
| `backend/tests/test_vote.c` | Проверка агрегатора голосов. |
| `backend/tests/reason_payload_test.c` | C-версия теста причины. |
| `backend/tests/bench_validation_test.c` | Проверка бенчмарков/формул. |

## Скрипты и утилиты

| Файл | Описание |
| --- | --- |
| `build_macos.sh` | Сборка на macOS с поиском OpenSSL. |
| `Makefile` | Описание целей сборки, тестов и очистки. |

Если добавляете новые файлы, расширяйте таблицы и ссылайтесь на них в
README и профильных документах.
