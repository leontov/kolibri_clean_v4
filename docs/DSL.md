# Kolibri DSL

Kolibri использует компактный язык выражений, представленный в виде деревьев. Каждый узел дерева принадлежит к одному из типов:

- `CONST` — числовая константа (double).
- `VAR_X` — переменная входа `x`.
- `ADD`, `SUB`, `MUL`, `DIV` — бинарные арифметические операции.
- `SIN`, `COS`, `TANH`, `EXP`, `LOG`, `ABS` — унарные функции.
- `CLAMP` — ограничение значения в диапазоне `[min, max]`.
- `IFZ` — тернарный узел: если `|cond| < ε`, вернуть `whenZero`, иначе `whenElse`.

## Правила построения

1. Максимальная глубина дерева по умолчанию — 4.
2. Деление защищено: при `|denom| < 1e-9` возвращается 0.
3. `LOG` работает только для положительных значений; иначе возвращается 0.
4. Для `CLAMP`, если `min > max`, они меняются местами.

## Представление формулы

Функция `dsl_print` выводит выражение в префиксной форме S-выражений, например:

```
(mul (sin x) (add 0.5 x))
```

Строковое представление однозначно соответствует структуре дерева и используется для сериализации в цепочку блоков.

## Мутации и упрощения

- `dsl_rand` создаёт случайное дерево ограниченной глубины.
- `dsl_mutate` клонирует формулу и заменяет случайный узел новым поддеревом или варьирует константу.
- `dsl_simplify` выполняет свёртку констант и устраняет очевидные комбинации.

## Оценка

`dsl_eval` вычисляет значение выражения при заданном `x` и является основой для подсчёта метрик.
