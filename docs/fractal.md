# Fractal-10 Positioning

Фрактальное позиционирование Kolibri кодирует каждый шаг рассуждения десятизначным адресом. Он строится из голосов агентов и управляет тем, как DSL-формула модифицируется по уровням вложенности.

## Fractal Address (FA-10)

* Источник данных — массив `votes[10]` из рантайма. Каждое значение нормируется в диапазон `[0, 1]` и преобразуется в цифру `d_i = round(9 * votes[i])`.
* Десять цифр объединяются в строку `fa = d_0 d_1 … d_9`. Это фрактальный адрес шага — координата в дереве решений.
* Стабильность префикса (`fa_stab`) равна длине общего префикса последних адресов в скользящем окне (по умолчанию 5 шагов). Высокое значение показывает, что поиск движется вдоль устойчивой траектории.

## Таблица трансформаций

Каждая цифра управляет преобразованием DSL-формулы на своём уровне `i`. Используется конфигурация `configs/fractal_map.default.json`, содержащая коэффициенты и масштаб `r`. На каждом шаге коэффициенты умножаются на `r^i`:

| Цифра | Преобразование | Описание |
|-------|----------------|----------|
| 0 | `noop` | Формула не меняется. |
| 1 | `F + a_i * sin(ω_i x)` | Гармоническое уточнение. |
| 2 | `F + b_i * x` | Линейный наклон. |
| 3 | `F + c_i * x^2` | Квадратичная поправка. |
| 4 | `tanh(κ_i * F)` | Сжатие значения в пределах [-1, 1]. |
| 5 | `F + d_i * exp(-γ_i x^2)` | Выделение окрестностей нуля. |
| 6 | `log(ε_i + |F|)` | Логарифмическая нормализация. |
| 7 | `F + e_i*sin(φ_i x) + f_i*cos(φ_i x)` | Пара гармоник для тонкой настройки. |
| 8 | `F + g_i * pow(|x| + 1e-3, p_i)` | Многочлен с дробной степенью. |
| 9 | `h_i * F` | Сглаживание/редукция сложности. |

## Построение формулы

1. Стартовая формула `F_0 = x`.
2. Для уровня `i` считывается цифра `d_i` из адреса и применяется соответствующее преобразование.
3. После десяти уровней получается итоговая формула `F = F_10`, сериализованная каноническим принтером DSL.

## Логирование

В JSON-пейлоад журнала добавлены поля:

* `fa` — десятизначный адрес.
* `fa_stab` — длина устойчивого префикса.
* `fa_map` — идентификатор таблицы трансформаций (например, `default_v1`).
* `r` — коэффициент масштабирования уровней.

Поля добавлены в конец структуры, поэтому хэши и HMAC продолжают вычисляться по тем же байтам. Изменение любого символа адреса детектируется проверкой цепочки.

## Метрики

* **FSI** — нормированная стабильность префикса. Сейчас выводится как `fa_stab`.
* **SSI** — индекс самоподобия масштабов, вычисляется на стороне аналитики по сохранённым адресам.
* **MDL-score** — комбинация эффективности и сложности; может использоваться в компоновщике модальностей.

## Визуализация

В интерфейсе можно отображать линейку из десяти делений с подписями операторов, чтобы наглядно показать, какие уровни активны и насколько стабилен курс поиска.
