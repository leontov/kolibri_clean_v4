# Руководство разработчика

> Ответственный: Кочуров Владислав Евгеньевич. Обновляйте руководство при
> любом изменении процессов, зависимостей или CI.

## Окружение

### Требования
- Linux/macOS, Python ≥ 3.11, make, clang/gcc с поддержкой C11.
- OpenSSL 1.1+ (используется для SHA/HMAC). На macOS устанавливайте через
  `brew install openssl@3`.
- Poetry/Pip необязательны: Python-модули не требуют сторонних пакетов.

### Настройка
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements-dev.txt  # если появится
make bin/kolibri_run  # сборка бэкенда (цели Makefile указываются с путём `bin/...`)
```

Для macOS используйте `./build_macos.sh bin/kolibri_run`: скрипт найдёт
OpenSSL, вызовет `make` с полной целью и соберёт бинарники в `bin/`.

## Рабочий процесс

1. Создайте issue или ссылку на пункт roadmap.
2. Согласуйте изменения с владельцем архитектуры (через PR описание).
3. Введите код, параллельно обновляя документацию.
4. Запустите проверки: `make tests` и целевые юнит-тесты Python (если
   добавляете новые).
5. Оформите коммит в ветке `main` (форки используют feature-ветки, но PR
   мержится в `main`).

### Правила коммитов

- Формат сообщения: `component: краткое описание`.
- Один коммит — одна логическая задача. Не смешивайте рефакторинг и
  функциональные изменения.
- Обязательно упоминайте обновлённые документы в описании PR.

### Ревью

- Автор PR описывает мотивацию, связанные документы и инструкции по
  проверке.
- Ревьюер проверяет синхронность документации и кода.
- Изменения, влияющие на безопасность, требуют двойного ревью (privacy +
  runtime).

## Тестирование

| Команда | Назначение |
| --- | --- |
| `make tests` | Собирает вспомогательные бинарники, запускает `tests/test_reason_payload.py` и `bin/bench_validation_test`. |
| `make test` | Проверяет агрегацию голосов через `bin/test_vote`. |
| `./bin/kolibri_verify logs/chain.jsonl` | Криптографическая проверка цепочки после запуска. |

Покрытие Python поддерживается модульно. При добавлении новых функций
создавайте тесты в `tests/` и отражайте команды запуска здесь.

## Стиль и качество

- C-код: C11, `-Wall -Wextra`, избегайте глобальных состояний без
  необходимости.
- Python: типы из `typing`, docstring в формате Google, избегайте
  сторонних зависимостей.
- Логи: используйте канонический JSON без пробелов, `printf("%.17g")` для
  чисел с плавающей точкой.

## Документация

- Любое изменение, влияющее на поведение, фиксируйте в README и профильных
  документах (см. [docs/index.md](index.md)).
- В PR перечисляйте обновлённые разделы, чтобы ревьюер проверил их.
- Минимальный набор файлов для обновления: README, module_reference и
  профильный раздел (architecture/operations/roadmap).

## Чек-лист перед релизом

- [ ] Собраны бинарники (`make bin/kolibri_run` или `./build_macos.sh bin/kolibri_run`).
- [ ] Пройдены `make tests` и пользовательские сценарии из operations guide.
- [ ] Обновлены roadmap, архитектура и инструкции по запуску.
- [ ] Обновлён `CHANGELOG` (если ведётся) и описаны заметные изменения в PR.

## Точки контакта

- **Техлид ядра** — отвечает за `backend/` и `kolibri_x/core`.
- **Техлид приватности** — следит за `kolibri_x/privacy` и журналами.
- **Техлид UX/XAI** — курирует `kolibri_x/xai` и документацию по миссиям.

Любые отклонения от процесса согласовывайте с Владиславом Кочуровым до
начала разработки.
