# Хранение цепочки Kolibri

Все знания Kolibri сохраняются в цепочке блоков. Каждый блок (`KolBlock`) содержит:

- `step` — номер шага.
- `digit_id` — лидер-цифра.
- `formula` — строковое представление формулы.
- `eff`, `compl` — метрики шага.
- `ts` — отметка времени.
- `hash`, `prev` — 32-байтовые хэши в hex-представлении.

## Формат

Запись ведётся в формате JSONL (`kolibri_chain.jsonl`): по одному объекту на строку. Для WebAssembly без файловой системы используется in-memory буфер на 512 блоков; экспорт в файл выполняется в native-сборке.

## Проверка

Хэш вычисляется детерминированно функцией `persist_hash_block`, которая смешивает шаг, лидера, формулу и предыдущий хэш. Скрипт `tools/chain_verify.js` повторяет алгоритм и проверяет целостность всей цепочки.

## Ограничения

- Запись только в конец (append-only).
- При переполнении in-memory буфера новые блоки отклоняются.
- Для долговременного хранения рекомендуется периодически экспортировать `kolibri_chain.jsonl`.
